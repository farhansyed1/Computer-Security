import sys
import base64
from Cryptodome.Cipher import AES

def readall(path):
    with open(path) as f:
        return f.read()

def check(filename):
    payloadOneVarText = 'variable_used_' + 'dkajhdskahsdkajdh'
    payloadTwoVarText = 'this_is_a_new_var_' + 'addsadahdashgdsag'
    
    # Read file
    with open(filename, 'r') as file:
        lines = file.readlines()

    # Unencrypted payload
    for line in lines:
        if payloadOneVarText in line:
            return 1
        elif payloadTwoVarText in line:
            return 2

    # Encrypted payload
    if 'key = base64.b64decode' in lines[3]:  # Key on line 4
        key = base64.b64decode(lines[3].strip().replace('key = base64.b64decode("""', '').replace('""")', '')) # Extract key
        c1 = base64.b64decode(lines[4].strip().replace('c1 = base64.b64decode("""', '').replace('""")', '')) # Extract c1
        cipher = AES.new(key, mode=AES.MODE_ECB)            
        decryptedPayload = cipher.decrypt(c1).decode()    # Decrypt payload with key

        if payloadOneVarText in decryptedPayload:
            return 1
        elif payloadTwoVarText in decryptedPayload:
            return 2
  
    return None

if __name__ == '__main__':
    check(sys.argv[1])

